<!-- ABOUTME: Displays a minimalist icebreaker question viewer with Firestore integration. -->
<!-- ABOUTME: Fetches, randomizes, and adds questions using Firebase's modular SDK. -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#f4f4f0" />
    <title>Icebreaker Questions</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --bg: #f4f4f0;
        --surface: #fbfaf7;
        --border: #d6d3c9;
        --text: #1a1a1a;
        --muted: #5b5b5b;
        --primary: #1a1a1a;
        --primary-text: #fefdf8;
        --focus: #2f6fed;
        --shadow: 0 16px 40px rgba(26, 26, 26, 0.12);
      }

      [data-theme='dark'] {
        color-scheme: dark;
        --bg: #0f1115;
        --surface: #181b21;
        --border: #2a2f39;
        --text: #f2f2f2;
        --muted: #b2b7c2;
        --primary: #f2f2f2;
        --primary-text: #111318;
        --focus: #8ab4ff;
        --shadow: 0 20px 45px rgba(0, 0, 0, 0.4);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Inter', sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      .page {
        position: relative;
        width: 100%;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: clamp(2.5rem, 4vw, 4.5rem) 1.5rem;
      }

      .card {
        width: min(720px, 92vw);
        max-width: 720px;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 2.25rem;
        padding: clamp(2rem, 4vw, 3rem);
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 24px;
        box-shadow: var(--shadow);
      }

      h1 {
        font-size: clamp(2rem, 4vw, 3.5rem);
        font-weight: 500;
        line-height: 1.3;
        margin: 0;
        will-change: transform, opacity;
      }

      .actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .button {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
        padding: 0.85rem 2.25rem;
        font-size: 1.05rem;
        min-width: 140px;
        min-height: 44px;
        font-family: inherit;
        border-radius: 999px;
        transition:
          background 0.18s ease,
          color 0.18s ease,
          border-color 0.18s ease,
          box-shadow 0.18s ease;
        cursor: pointer;
      }

      .button.primary {
        background: var(--primary);
        border-color: var(--primary);
        color: var(--primary-text);
      }

      .button.secondary {
        background: transparent;
        border-color: var(--border);
        color: var(--text);
      }

      .button.primary:hover {
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 20%, transparent);
      }

      .button.secondary:hover {
        border-color: var(--text);
        background: color-mix(in srgb, var(--text) 6%, transparent);
      }

      .button:active {
        transform: translateY(1px);
      }

      .button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .button:focus-visible {
        outline: 2px solid var(--focus);
        outline-offset: 3px;
      }

      .theme-toggle {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        width: 44px;
        height: 44px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        cursor: pointer;
        transition:
          background 0.18s ease,
          border-color 0.18s ease,
          color 0.18s ease,
          box-shadow 0.18s ease;
      }

      .theme-toggle:hover {
        border-color: var(--text);
      }

      .theme-toggle:active {
        transform: translateY(1px);
      }

      .theme-toggle:focus-visible {
        outline: 2px solid var(--focus);
        outline-offset: 3px;
      }

      form {
        display: none;
        gap: 1rem;
        flex-direction: column;
        align-items: center;
      }

      form.active {
        display: flex;
      }

      input {
        width: min(420px, 90vw);
        padding: 0.75rem 1rem;
        border-radius: 999px;
        border: 1px solid var(--border);
        font-size: 1rem;
        font-family: inherit;
        background: transparent;
        color: inherit;
      }

      .helper {
        font-size: 0.95rem;
        color: var(--muted);
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <button
        id="theme-toggle"
        class="theme-toggle"
        type="button"
        aria-label="Toggle color theme"
      >
        <span aria-hidden="true">◐</span>
      </button>
      <main class="card">
        <h1 id="question">Loading question…</h1>
        <p class="helper">hmm</p>
        <div class="actions">
          <button id="next" class="button primary" type="button">Next</button>
          <button id="add" class="button secondary" type="button">Add</button>
        </div>
        <form id="form">
          <input
            id="input"
            type="text"
            placeholder="Add a new question"
            autocomplete="off"
          />
          <button id="submit" class="button secondary" type="submit">
            Submit
          </button>
        </form>
      </main>
    </div>

    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
      import {
        getFirestore,
        collection,
        getDocs,
        addDoc,
      } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
      import { createQuestionQueue } from './question-queue.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyDrfolJCLUeizZkkAOACygxRcV9Kv1Weds',
        authDomain: 'icebreaker-fd620.firebaseapp.com',
        projectId: 'icebreaker-fd620',
        storageBucket: 'icebreaker-fd620.firebasestorage.app',
        messagingSenderId: '24703380392',
        appId: '1:24703380392:web:c743834816325a12c50b9d',
        measurementId: 'G-J3XN49FGV6',
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const questionsCollection = collection(db, 'questions');

      const questionEl = document.getElementById('question');
      const nextButton = document.getElementById('next');
      const addButton = document.getElementById('add');
      const form = document.getElementById('form');
      const input = document.getElementById('input');
      const themeToggle = document.getElementById('theme-toggle');
      const themeMeta = document.querySelector('meta[name="theme-color"]');

      let questions = [];
      const questionQueue = createQuestionQueue();
      let questionAnimation = null;

      const themeColors = {
        light: '#f4f4f0',
        dark: '#0f1115',
      };

      const getStoredTheme = () => {
        const stored = localStorage.getItem('theme');
        if (stored === 'light' || stored === 'dark') {
          return stored;
        }

        return null;
      };

      const getPreferredTheme = () => {
        const stored = getStoredTheme();
        if (stored) {
          return stored;
        }

        return window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'light';
      };

      const applyTheme = (theme) => {
        document.documentElement.setAttribute('data-theme', theme);
        if (themeMeta && themeColors[theme]) {
          themeMeta.setAttribute('content', themeColors[theme]);
        }
        if (themeToggle) {
          themeToggle.setAttribute('aria-pressed', theme === 'dark');
        }
      };

      const animateQuestion = () => {
        if (!questionEl) {
          return;
        }

        if (questionAnimation) {
          questionAnimation.cancel();
        }

        const prefersReducedMotion = window.matchMedia(
          '(prefers-reduced-motion: reduce)'
        ).matches;
        const keyframes = prefersReducedMotion
          ? [{ opacity: 0 }, { opacity: 1 }]
          : [
              { opacity: 0, transform: 'translateY(8px)' },
              { opacity: 1, transform: 'translateY(0)' },
            ];

        questionAnimation = questionEl.animate(keyframes, {
          duration: prefersReducedMotion ? 120 : 180,
          easing: 'cubic-bezier(0.2, 0.6, 0.2, 1)',
          fill: 'both',
        });
      };

      const shuffleQuestions = (items) => {
        const shuffled = [...items];

        for (let index = shuffled.length - 1; index > 0; index -= 1) {
          const swapIndex = Math.floor(Math.random() * (index + 1));
          [shuffled[index], shuffled[swapIndex]] = [
            shuffled[swapIndex],
            shuffled[index],
          ];
        }

        return shuffled;
      };

      const pickRandomQuestion = () => {
        const nextQuestion = questionQueue.next();
        if (!nextQuestion) {
          questionEl.textContent = 'No questions yet. Add the first one!';
          animateQuestion();
          return;
        }

        questionEl.textContent = nextQuestion;
        animateQuestion();
      };

      const loadQuestions = async () => {
        try {
          const snapshot = await getDocs(questionsCollection);
          questions = snapshot.docs
            .map((doc) => doc.data()?.text)
            .filter((text) => typeof text === 'string');
          questionQueue.setQuestions(shuffleQuestions(questions));
          pickRandomQuestion();
        } catch (error) {
          questionEl.textContent = 'Unable to load questions right now.';
        }
      };

      nextButton.addEventListener('click', () => {
        pickRandomQuestion();
      });

      addButton.addEventListener('click', () => {
        form.classList.toggle('active');
        if (form.classList.contains('active')) {
          input.focus();
        }
      });

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const value = input.value.trim();

        if (!value) {
          alert('Please enter a question.');
          return;
        }

        try {
          await addDoc(questionsCollection, { text: value });
          questions = [...questions, value];
          questionQueue.addQuestion(value);
          input.value = '';
          form.classList.remove('active');
          alert('Question added.');
          pickRandomQuestion();
        } catch (error) {
          alert('Unable to add the question right now.');
        }
      });

      const initialTheme = getPreferredTheme();
      applyTheme(initialTheme);

      themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const nextTheme = currentTheme === 'dark' ? 'light' : 'dark';
        localStorage.setItem('theme', nextTheme);
        applyTheme(nextTheme);
      });

      loadQuestions();
    </script>
  </body>
</html>
